<div class="p-d-flex p-jc-start p-flex-column">
  <buffer--bucket-header headerTitle="Published"></buffer--bucket-header>

  <section class="b-hs-wt-h b-of-h">
    <p-table [alwaysShowPaginator]="false" [filterDelay]="0" [globalFilterFields]="['postCaption']" [paginator]="true"
      currentPageReportTemplate="Showing {first} to {last} of {totalRecords} posts" #postTable [rows]="5"
      [showCurrentPageReport]="true" [value]="calendarPosts | async" dataKey="id" [scrollable]="true"
      scrollHeight="540px">
      <ng-template pTemplate="caption">
        <div class="p-px-2 p-grid p-pt-2">
          <div class="p-px-2 p-col-3">
            <span class="p-input-icon-left b-w-full">
              <i class="pi pi-search"></i>
              <input pInputText type="text" (input)="postTable.filterGlobal($event.target.value, 'contains')"
                placeholder="Search post" class="p-inputtext-sm b-w-full" />
            </span>
          </div>
          <div class="p-px-2 p-col-2">
            <p-calendar [readonlyInput]="true" [showButtonBar]="true" [showIcon]="true" appendTo="body"
              dateFormat="D, M dd, yy" placeholder="Published Date" styleClass="p-column-filter p-inputtext-sm b-w-full"
              (onClearClick)="postTable.filter('', 'postScheduleDateTime', 'equals')"
              (onSelect)="postTable.filter($event.toDateString(), 'postScheduleDateTime', 'equals')">
            </p-calendar>
          </div>
          <div class="p-px-2 p-col-2">
            <p-dropdown [options]="connectionItems"
              (onChange)="postTable.filter($event.value, 'postConnection.connectionType', 'equals')" appendTo="body"
              styleClass="p-column-filter b-w-full p-inputtext-sm" placeholder="Connection" [showClear]="true"
              [filter]="true">
              <ng-template let-option pTemplate="item">
                <small class="p-text-capitalize">{{option.label}}</small>
              </ng-template>
            </p-dropdown>
          </div>
          <div class="p-px-2 p-col-2">
            <p-dropdown [options]="postTypes" (onChange)="postTable.filter($event.value, 'postType', 'equals')"
              appendTo="body" styleClass="p-column-filter b-w-full p-inputtext-sm" placeholder="Post type"
              [showClear]="true" [filter]="true">
              <ng-template let-option pTemplate="item">
                <small class="p-text-capitalize">{{option.label}}</small>
              </ng-template>
            </p-dropdown>
          </div>
        </div>
      </ng-template>
      <ng-template pTemplate="body" let-post>
        <tr>
          <td class="p-pr-3">
            <div class="b-w-full" *ngIf="post.postType === postType.IMAGE || post.postType === postType.VIDEO">
              <div [ngSwitch]="post.postType">
                <div *ngSwitchCase="postType.IMAGE">
                  <p-carousel [value]="post.postMedia" [numVisible]="1" [numScroll]="2" indicatorsContentClass="b-d-h"
                    styleClass="buffer--height-20">
                    <ng-template let-postMedia pTemplate="item">
                      <div class="b-w-full b-h-full p-d-flex p-jc-between p-ai-center">
                        <img [alt]="postMedia.mediaName" [src]="postMedia.mediaURL" class="b-w-full b-br-sm" />
                      </div>
                    </ng-template>
                  </p-carousel>
                </div>
                <div *ngSwitchCase="postType.VIDEO" class="p-px-4">
                  <vg-player class="b-w-full b-br-sm">
                    <vg-controls vgFor="postVideo">
                      <vg-play-pause></vg-play-pause>
                    </vg-controls>
                    <video #media [vgMedia]="media" id="postVideo" preload="auto" [vgMaster]="true"
                      [src]="post.postMedia[0].mediaURL" type="video/mp4" class="b-w-full b-br-sm">
                    </video>
                  </vg-player>
                </div>
              </div>
            </div>
          </td>
          <td colspan="3" class="p-pr-5">
            <div class="b-text-fade">
              <p class="b-c-black">{{ post.postCaption }}</p>
            </div>
          </td>
          <td class="p-mx-auto">
            <div class="p-d-flex p-flex-column">
              <small class="p-mb-2"><i class="pi pi-calendar b-va-m p-mr-1"></i>
                {{ post.postScheduleDateTime | date: 'EEE, MMM dd, y' }}</small>
              <small><i class="pi pi-clock b-va-m p-mr-1"></i> {{ post.postScheduleDateTime | date: 'h:mm a' }}</small>
            </div>
          </td>
          <td>
            <div class="p-d-flex p-jc-between p-ai-center">
              <span
                [ngClass]="{ 'p-tag-warning': post.postType === postType.TEXT, 'p-tag-success': post.postType === postType.IMAGE, 'p-tag-info': post.postType === postType.VIDEO}"
                class="p-text-capitalize p-tag">{{ post.postType }}</span>
              <div class="b-ca b-ca-md p-mx-auto"
                [title]="splitConnectionType(post.postConnection.connectionType ? post.postConnection.connectionType: '')">
                <img [lazyLoad]="post.postConnection.connectionPicture" class="b-w-full b-h-full b-br-full"
                  defaultImage="/assets/images/svg/default-media.svg"
                  errorImage="/assets/images/svg/default-media.svg" />
                <div [attr.class]="'b-ca-sl b-ca-sl-' + post.postConnection.connectionType">
                </div>
              </div>
            </div>
          </td>
          <td class="p-pr-3">
            <button pButton label="Reschedule" class="p-button-sm b-w-full"></button>
          </td>
        </tr>
      </ng-template>
      <ng-template pTemplate="emptymessage">
        <tr>
          <td colspan="4">
            <div class="p-m-5">
              <div class="b-h-full p-d-flex p-flex-column p-ai-center">
                <div class="p-my-5 p-text-center">
                  <h3>No post found</h3>
                </div>
              </div>
            </div>
          </td>
        </tr>
      </ng-template>
    </p-table>
  </section>
</div>